@{
    ViewData["Title"] = "Chi tiết khóa học";
    var khoaHoc = ViewBag.KhoaHoc as DoAn4_ClassOnline.Models.KhoaHoc;
}

<!-- ⭐ THÊM DATA ATTRIBUTE ĐỂ JAVASCRIPT LẤY ĐƯỢC ⭐ -->
<div class="container" data-khoa-hoc-id="@(khoaHoc?.KhoaHocId)">
    <!--ẩn: Id khóa học-->
    <input type="hidden" id="khoaHocId_ChiTiet" name="khoaHocId_ChiTiet" value="@(khoaHoc?.KhoaHocId)" />
    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- Nút quay lại -->
        <a class="btn border-0" asp-controller="Home" asp-action="Index">
            <i class="bi bi-chevron-left"></i> Quay lại
        </a>

        <!-- Tiêu đề động với ID để có thể cập nhật -->
        <h3 class="fw-bold text-center flex-grow-1 mb-0" id="courseTitle">
            @if (khoaHoc != null)
            {
                <span id="courseName">@khoaHoc.TenKhoaHoc</span>
                <text> - </text>
                <span id="teacherName">@khoaHoc.GiaoVien.FullName</span>
            }
            else
            {
                <span class="text-muted">Không tìm thấy khóa học</span>
            }
        </h3>

        <!-- Chỗ trống bên phải để cân đối -->
        <div style="width: 90px;"></div>
    </div>

    <div class="row row-cols-2 row-cols-md-5 g-4">
        <!-- Card 2 -->
        <div class="col">
            <a id="btnThongBao" style="text-decoration: none;">
                <div class="card custom-card text-center p-2 h-95 border-0 rounded-4 bg-body-tertiary text-primary">
                    <div class="icon mb-2 position-relative" style="display: inline-block;">
                        <i class="bi bi-bell fs-1"></i>
                    </div>
                    <h6 class="fw-bold mb-2">Thông báo</h6>
                </div>
            </a>
        </div>

        <!-- Card 3 -->
        <div class="col">
            <a id="btnTaiLieu" style="text-decoration: none;">
                <div class="card custom-card text-center p-2 h-95 border-0 rounded-4 bg-body-tertiary">
                    <div class="icon mb-2"><i class="bi bi-file-earmark-text fs-1"></i></div>
                    <h6 class="fw-bold mb-2">Tài liệu</h6>
                </div>
            </a>
        </div>

        <!-- Card 4 -->
        <div class="col">
            <a id="btnTracNghiem" style="text-decoration: none;">
                <div class="card custom-card text-center p-2 h-95 border-0 rounded-4 bg-body-tertiary">
                    <div class="icon mb-2"><i class="bi bi-card-checklist fs-1"></i></div>
                    <h6 class="fw-bold mb-2">Trắc nghiệm</h6>
                </div>
            </a>
        </div>

        <!-- Card 5 -->
        <div class="col">
            <a id="btnBaiTap" style="text-decoration: none;">
                <div class="card custom-card text-center p-2 h-95 border-0 rounded-4 bg-body-tertiary">
                    <div class="icon mb-2"><i class="bi bi-file-arrow-up fs-1"></i></div>
                    <h6 class="fw-bold mb-2">Bài tập</h6>
                </div>
            </a>
        </div>

        <!-- Card 1 - Google Meet -->
        <div class="col">
            <div>
                <div class="card custom-card text-center p-2 h-95 border-0 rounded-4 bg-body-tertiary">
                    <div class="icon mb-2"><img src="/assets/image/meet.png" style="width:50px" alt="" /></div>
                    <button class="btn btn-success text-white px-4 rounded-pill"
                            onclick='GetLinkGGMeet("@(khoaHoc?.LinkHocOnline ?? "")")'
                            style="background-color:#0055ff"
                            data-bs-toggle="modal"
                            data-bs-target="#joinMeetModal">
                        <i class="bi bi-camera-video me-1"></i> Tạo phòng
                    </button>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal nhập link Meet -->
    <div class="modal fade" id="joinMeetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-4">
                <div class="modal-header">
                    <h5 class="modal-title">Tạo phòng học Google Meet</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body mb-2">
                    <label class="form-label">Nhập hoặc thay đổi link Google Meet:</label>
                    <input type="text" id="meetLink" class="form-control" value="@(khoaHoc?.LinkHocOnline ?? "")">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary text-light" onclick="startMeeting()">
                        Bắt đầu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Khu vực load nội dung -->
    <div id="noiDungContainer" class="mt-4">
        @await Html.PartialAsync("_ThongBaoPartial")
    </div>
</div>

<script>
    // Lắng nghe sự kiện cập nhật profile
    document.addEventListener('profileUpdated', function(e) {
        console.log('Profile updated event received:', e.detail);
        
        // Cập nhật tên giáo viên trong tiêu đề
        const teacherNameElement = document.getElementById('teacherName');
        if (teacherNameElement && e.detail.userInfo && e.detail.userInfo.fullName) {
            teacherNameElement.textContent = e.detail.userInfo.fullName;
            console.log('Teacher name updated to:', e.detail.userInfo.fullName);
        }
    });
        function GetLinkGGMeet(existingLink = '') {
        const meetLinkInput = document.getElementById('meetLink');
        if (!meetLinkInput) {
            console.warn("Không tìm thấy input #meetLink");
            return;
        }
        meetLinkInput.value = existingLink;
    }
</script>
<script src="~/assets/js/teacher/quanly-thongbao.js"></script>
<script src="~/assets/js/teacher/quanly-tailieu.js"></script>


