@{
    var thongBaos = ViewBag.ThongBaos as List<DoAn4_ClassOnline.Models.ThongBao> ?? new List<DoAn4_ClassOnline.Models.ThongBao>();
    var khoaHocId = ViewBag.KhoaHocId ?? 0;
}

<div class="row g-3 mt-4 p-3 shadow rounded-4 bg-white">
    <h5 class="fw-bold mb-3">
        <i class="bi bi-bell me-2 text-danger"></i> Các thông báo chính
    </h5>

    @if (thongBaos == null || thongBaos.Count == 0)
    {
        <div class="col-12">
            <div class="alert alert-info text-center">
                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                <p class="mb-0">Chưa có thông báo nào trong khóa học này.</p>
                <small class="text-muted">Total count: @(thongBaos?.Count ?? -1)</small>
            </div>
        </div>
    }
    else
    { 
        @foreach (var tb in thongBaos)
        {
            var collapseId = $"collapseThongBao{tb.ThongBaoId}";
            var ngayTao = tb.NgayTao != null 
                ? ((DateTime)tb.NgayTao).ToString("dd/MM/yyyy - HH:mm")
                : "N/A";

            <div class="col-12">
                <!-- Header thông báo -->
                <div class="border rounded-3 p-3 mb-2 bg-body-tertiary">
                    <a class="text-decoration-none text-dark d-flex justify-content-between align-items-center"
                       data-bs-toggle="collapse" href="#@collapseId" role="button" 
                       aria-expanded="false" aria-controls="@collapseId">

                        <div class="d-flex flex-column flex-md-row justify-content-between w-100">
                            <div>
                                <strong>Thông báo: </strong>
                                @tb.TieuDe
                            </div>
                            <div class="text-muted small ms-md-3 mt-2 mt-md-0 me-2">
                                <span class="text-muted">
                                    <i class="bi bi-clock me-1"></i> @ngayTao
                                </span>
                            </div>
                        </div>
                        <i class="bi bi-chevron-down ms-2"></i>
                    </a>
                </div>

                <!-- Nội dung chi tiết -->
                <div class="collapse" id="@collapseId">
                    <div class="p-3 border rounded-3 mb-3" style="background-color:rgba(243,246,248);">
                        <div>
                            <strong>Chi tiết:</strong>
                            <div class="mt-2">
                                @Html.Raw(tb.NoiDung?.Replace("\n", "<br/>") ?? "Không có nội dung")
                            </div>
                        </div>
                        
                        @if (tb.NgayCapNhat != null && tb.NgayCapNhat != tb.NgayTao)
                        {
                            <div class="mt-3 pt-2 border-top">
                                <small class="text-muted">
                                    <i class="bi bi-pencil me-1"></i>
                                    Cập nhật lần cuối: @(((DateTime)tb.NgayCapNhat).ToString("dd/MM/yyyy - HH:mm"))
                                </small>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    }
</div>

<style>
    /* ⭐ ANIMATION CHO CHEVRON ICON ⭐ */
    .collapsed .bi-chevron-down {
        transition: transform 0.3s ease;
    }
    
    [aria-expanded="true"] .bi-chevron-down {
        transform: rotate(180deg);
    }
    
    /* ⭐ HOVER EFFECT ⭐ */
    .bg-body-tertiary:hover {
        background-color: #e9ecef !important;
        transition: background-color 0.2s ease;
    }
</style>
