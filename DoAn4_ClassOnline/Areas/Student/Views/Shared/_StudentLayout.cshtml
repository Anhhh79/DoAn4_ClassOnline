@using DoAn4_ClassOnline.Models
@using Microsoft.EntityFrameworkCore
@inject ApplicationDbContext _context
@{
    // ⭐ LẤY THÔNG TIN TỪ SESSION ⭐
    var userId = Context.Session.GetInt32("UserId");
    var fullName = Context.Session.GetString("FullName") ?? "Sinh viên";
    var avatar = Context.Session.GetString("Avatar") ?? "~/assets/image/logo.png";
    var email = Context.Session.GetString("Email") ?? "";
    var phone = Context.Session.GetString("PhoneNumber") ?? "";
    var maSo = Context.Session.GetString("MaSo") ?? "";
    var gioiTinh = Context.Session.GetString("GioiTinh") ?? "";
    var ngaySinh = Context.Session.GetString("NgaySinh") ?? "";
    var roleName = Context.Session.GetString("RoleName") ?? "Sinh viên";
    
    // ⭐ LẤY TÊN KHOA TỪ DATABASE ⭐
    var tenKhoa = "";
    if (userId.HasValue)
    {
        var user = await _context.Users
            .Include(u => u.Khoa)
            .FirstOrDefaultAsync(u => u.UserId == userId);
        tenKhoa = user?.Khoa?.TenKhoa ?? "Chưa có thông tin";
    }
}

<!doctype html>
<html lang="vi" dir="ltr" data-bs-theme="auto">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Thông tin SEO cơ bản -->
	<meta name="description" content="Lớp học online - Nền tảng học trực tuyến giúp giáo viên và học sinh kết nối dễ dàng, học mọi lúc mọi nơi.">
	<meta name="keywords" content="lớp học online, học trực tuyến, elearning, giáo viên, học sinh, khóa học online">
	<meta name="author" content="BaoAnhNguyen">
	<meta name="generator" content="ASP.NET Core MVC + Bootstrap">

	<!-- Tiêu đề động (thay đổi theo View) -->
	<title>@ViewData["Title"] - Lớp Học Online</title>

	<!-- CSS -->
	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap Icons CDN -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
	<!-- Font Awesome CDN -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

	<!-- thư viện lịch Flatpickl Bootstraps -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">



	<!-- Open Graph (chia sẻ MXH như Facebook, Zalo) -->
	<meta property="og:title" content="Lớp Học Online - Kết nối giáo viên và học sinh">
	<meta property="og:description" content="Khám phá các khóa học trực tuyến chất lượng, hỗ trợ học sinh tiếp thu kiến thức hiệu quả.">
	<meta property="og:image" content="https://yourdomain.com/assets/images/og-classroom.jpg">
	<meta property="og:url" content="https://yourdomain.com/">
	<meta property="og:type" content="website">
	<meta property="og:locale" content="vi_VN">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content=""/>
	<meta name="twitter:title" content="Lớp Học Online - Kết nối giáo viên và học sinh">
	<meta name="twitter:description" content="Nền tảng học trực tuyến với nhiều khóa học hấp dẫn, dễ dàng kết nối giữa giáo viên và học sinh.">
	<meta name="twitter:image" content="https://yourdomain.com/assets/images/og-classroom.jpg">

	<!-- Canonical URL -->
	<link rel="canonical" href="https://yourdomain.com/">
	<!-- CSS nhỏ — đặt sau bootstrap.css -->
	<link rel="stylesheet" href="~/assets/css/student/css_layout.css">
    <link rel="stylesheet" href="~/assets/css/student/css_home.css">
	<link rel="stylesheet" href="~/assets/css/student/KhoaHoc.css">
</head>

<body class="d-flex flex-column min-vh-100">
	<!--Header-->
	<header class="navigation fixed-top w-100 bg-body-tertiary " style="z-index:1050;">
		<nav class="navbar navbar-expand-xl" aria-label="Main navigation">
			<div class="container py-1 d-flex justify-content-between align-items-center">

				<!-- Nút 3 gạch khi màn hình nhỏ -->
				<button class="btn d-md-none border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
					<i class="bi bi-list fs-2"></i>
				</button>

				<!-- Logo -->
				<a asp-controller="Home" asp-action="Index" class="navbar-brand d-flex align-items-center d-none d-md-flex">
					<img src="~/assets/image/logo.png" height="40" alt="logo">
				</a>
				<!-- Thanh tìm kiếm Desktop -->
				<form class="d-none d-md-flex mx-auto flex-grow-1 px-3" role="search" style="max-width: 500px;">
					<div class="position-relative w-100">
						<span class="position-absolute top-50 start-0 translate-middle-y ps-3 text-muted">
							<i class="bi bi-search"></i>
						</span>
						<input id="searchInputDesktop"
							   class="form-control rounded-pill ps-5"
							   type="search"
							   placeholder="Tìm kiếm khóa học, giáo viên..."
							   aria-label="Search">

						<!-- Dropdown kết quả -->
						<div id="searchResultsDesktop"
							 class="position-absolute shadow rounded mt-1 w-100 d-none p-2 bg-body"
							 style="z-index:1050; max-height:300px; overflow-y:auto;">

							<!-- Khóa học -->
							<div class="fw-semibold text-muted text-uppercase small px-2 pt-2">Khóa học</div>
							<div class="list-group list-group-flush">
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-2 bg-body">
									Lập Trình JavaScript Cơ Bản
								</a>
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-2 bg-body">
									Lập Trình JavaScript Nâng Cao
								</a>
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-2 bg-body">
									JavaScript Pro
								</a>
							</div>

							<!-- Giáo viên -->
							<div class="fw-semibold text-muted text-uppercase small px-2 pt-3">Giáo viên</div>
							<div class="list-group list-group-flush">
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-2 bg-body">
									Nguyễn Bảo Anh - Kỹ sư Phần mềm
								</a>
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-2 bg-body">
									Trần Văn B - Chuyên gia Frontend
								</a>
							</div>

						</div>
					</div>
				</form>

				<!-- Thanh tìm kiếm Mobile -->
				<form class="d-flex d-md-none align-items-center ms-2" role="search" style="max-width: 200px;">
					<div class="position-relative w-100">
						<span class="position-absolute top-50 start-0 translate-middle-y ps-2 text-muted">
							<i class="bi bi-search"></i>
						</span>
						<input id="searchInputMobile"
							   class="form-control form-control-sm rounded-pill ps-5"
							   type="search"
							   placeholder="Tìm kiếm..."
							   aria-label="Tìm kiếm">

						<!-- Dropdown kết quả -->
						<div id="searchResultsMobile"
							 class="position-absolute shadow rounded mt-1 w-100 d-none p-2 bg-body"
							 style="z-index:1050; max-height:300px; overflow-y:auto;">

							<!-- Khóa học -->
							<div class="fw-semibold text-muted text-uppercase small px-2 pt-2">Khóa học</div>
							<div class="list-group list-group-flush">
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-1 small">
									Lập Trình JavaScript Cơ Bản
								</a>
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-1 small">
									Lập Trình JavaScript Nâng Cao
								</a>
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-1 small">
									JavaScript Pro
								</a>
							</div>

							<!-- Giáo viên -->
							<div class="fw-semibold text-muted text-uppercase small px-2 pt-3">Giáo viên</div>
							<div class="list-group list-group-flush">
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-1 small">
									Nguyễn Bảo Anh - Kỹ sư Phần mềm
								</a>
								<a href="#" class="list-group-item list-group-item-action border-0 d-flex align-items-center py-1 small">
									Trần Văn A - Chuyên gia Frontend
								</a>
							</div>
						</div>

					</div>
				</form>


				<!-- Nhóm bên phải -->
				<div class="d-flex align-items-center gap-3">

					<!-- Nút chuông -->
					<div class="nav-item dropdown">
						<button type="button" class="btn position-relative bg-body-secondary-hover rounded-circle p-2 dropdown-toggle no-caret"
								id="notifyDropdown" data-bs-toggle="dropdown" aria-expanded="false">
							<i class="bi bi-bell fs-5 text-body-emphasis"></i>
							<span class="position-absolute bg-danger border border-light rounded-circle"
								  style="width: 8px; height: 8px; top: 8px; right: 5px;">
							</span>
						</button>
						<!-- Dropdown thông báo -->
						<ul class="dropdown-menu dropdown-menu-end shadow rounded-3 border-0 p-2" aria-labelledby="notifyDropdown"
							style="width: 320px; max-height: 320px; overflow-y: auto;">
							<li class="dropdown-header fw-semibold d-flex justify-content-between align-items-center">
								Thông báo
								<span class="badge bg-primary rounded-pill">3</span>
							</li>
							<li><hr class="dropdown-divider"></li>
							<li>
								<a class="dropdown-item d-flex align-items-start gap-2 py-2" href="#">
									<span class="text-primary fs-5">📢</span>
									<div>
										<div class="fw-semibold">Bạn có 1 tin nhắn mới</div>
										<small class="text-muted">2 phút trước</small>
									</div>
								</a>
							</li>
							<li>
								<a class="dropdown-item d-flex align-items-start gap-2 py-2" href="#">
									<span class="text-success fs-5">✅</span>
									<div>
										<div class="fw-semibold">Lịch dạy đã được cập nhật</div>
										<small class="text-muted">1 giờ trước</small>
									</div>
								</a>
							</li>
							<li>
								<a class="dropdown-item d-flex align-items-start gap-2 py-2" href="#">
									<span class="text-warning fs-5">⚠️</span>
									<div>
										<div class="fw-semibold">Hệ thống sẽ bảo trì lúc 22h</div>
										<small class="text-muted">Hôm nay</small>
									</div>
								</a>
							</li>
							<li><hr class="dropdown-divider"></li>
							<li>
								<a class="dropdown-item text-center fw-semibold text-primary" href="#">Xem tất cả</a>
							</li>
						</ul>
					</div>

					<!-- Avatar - DYNAMIC -->
					<div class="nav-item dropdown">
						<button class="btn d-flex align-items-center border-0 bg-transparent dropdown-toggle p-0 no-caret"
								id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
							<img src="@avatar" alt="avatar" class="rounded-circle me-2" width="32" height="32" 
							     onerror="this.src='~/assets/image/logo.png'">
							<div class="lh-1 text-start d-none d-md-block">
								<div class="fw-semibold">@fullName</div>
								<small class="text-muted">@roleName</small>
							</div>
						</button>
						<ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
							<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#profileModal">Thông tin cá nhân</a></li>
							<li><hr class="dropdown-divider"></li>
							<li>
								<form method="post" asp-area="Admin" asp-controller="DangNhap" asp-action="Logout">
									@Html.AntiForgeryToken()
									<button type="submit" class="dropdown-item text-danger">Đăng xuất</button>
								</form>
							</li>
						</ul>
					</div>

					<!-- ⭐ MODAL THÔNG TIN CÁ NHÂN ⭐ -->
					<div class="modal fade" id="profileModal" tabindex="-1" data-bs-backdrop="false" data-bs-keyboard="true" aria-labelledby="profileModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-lg modal-dialog-centered">
							<div class="modal-content border-0 shadow-lg">
								<div class="modal-header p-0">
									<div class="w-100 d-flex align-items-center justify-content-between px-4 py-3 rounded-top">
										<h5 class="modal-title m-0" id="profileModalLabel">Thông tin cá nhân</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
									</div>
								</div>

								<div class="modal-body p-4">
									<form id="profileForm" novalidate>
										<div class="row g-3">
											<!-- Avatar -->
											<div class="col-md-4 text-center">
												<div class="position-relative d-inline-block">
													<img id="avatarPreview" src="@avatar" alt="Avatar" 
													     class="rounded-circle img-thumbnail" 
													     style="width:150px;height:150px;object-fit:cover;box-shadow:0 6px 18px rgba(0,0,0,0.15);"
													     onerror="this.src='~/assets/image/logo.png'">
													<label for="avatarInput" class="position-absolute bottom-0 end-0 translate-middle bg-white rounded-circle p-1 border" style="cursor:pointer;">
														<!-- icon upload -->
														<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#0d6efd" viewBox="0 0 16 16">
															<path d="M10.5 2a.5.5 0 0 1 .5.5V4h1.5A1.5 1.5 0 0 1 14 5.5v7A1.5 1.5 0 0 1 12.5 14h-9A1.5 1.5 0 0 1 2 12.5v-7A1.5 1.5 0 0 1 3.5 4H5V2.5a.5.5 0 0 1 .5-.5h5zM5 4h6v1H5V4z" />
														</svg>
													</label>
													<input id="avatarInput" type="file" accept="image/*" class="d-none" aria-label="Upload ảnh đại diện">
												</div>
												<h5 class="mt-3 mb-1 fw-bold" id="displayName">@fullName</h5>
												<div class="small text-muted" id="displayRole">@roleName</div>
											</div>

											<!-- Fields -->
											<div class="col-md-8">
												<div class="row g-2">
													<div class="col-md-6">
														<div class="form-floating">
															<input type="text" class="form-control" id="firstName_InforSinhVien" 
															       name="firstName" placeholder="Họ và tên" value="@fullName" required>
															<label for="firstName_InforSinhVien">Họ và tên</label>
															<div class="invalid-feedback">Vui lòng nhập họ và tên.</div>
														</div>
													</div>

													<div class="col-md-6">
														<div class="form-floating">
															<input type="text" class="form-control" id="dob" 
															       name="dob" value="@ngaySinh" placeholder="Ngày sinh">
															<label for="dob">Ngày sinh</label>
															<div class="invalid-feedback">Ngày sinh không hợp lệ.</div>
														</div>
													</div>

													<div class="col-md-6">
														<div class="form-floating">
															<input type="email" class="form-control" id="email_InforSinhVien" 
															       name="email" value="@email" placeholder="Email" required>
															<label for="email_InforSinhVien">Email</label>
															<div class="invalid-feedback">Email không hợp lệ.</div>
														</div>
													</div>

													<div class="col-md-6">
														<div class="form-floating">
															<input type="tel" class="form-control" id="phone_InforSinhVien" 
															       name="phone" value="@phone" placeholder="Số điện thoại" pattern="[\d\s\+\-()]{6,}">
															<label for="phone_InforSinhVien">Số điện thoại</label>
															<div class="invalid-feedback">Số điện thoại không hợp lệ.</div>
														</div>
													</div>

													<div class="col-md-6">
														<label class="form-label small mb-1">Giới tính</label>
														<div class="d-flex gap-2">
															<div class="form-check">
																<input class="form-check-input" type="radio" name="gender" 
																       id="genderMale_InforSinhVien" value="Nam" 
																       @(gioiTinh == "Nam" ? "checked" : "")>
																<label class="form-check-label" for="genderMale_InforSinhVien">Nam</label>
															</div>
															<div class="form-check">
																<input class="form-check-input" type="radio" name="gender" 
																       id="genderFemale_InforSinhVien" value="Nữ" 
																       @(gioiTinh == "Nữ" ? "checked" : "")>
																<label class="form-check-label" for="genderFemale_InforSinhVien">Nữ</label>
															</div>
															<div class="form-check">
																<input class="form-check-input" type="radio" name="gender" 
																       id="genderOther_InforSinhVien" value="Khác" 
																       @(gioiTinh == "Khác" ? "checked" : "")>
																<label class="form-check-label" for="genderOther_InforSinhVien">Khác</label>
															</div>
														</div>
													</div>

													<div class="col-md-6">
														<div class="form-floating">
															<input type="text" class="form-control bg-body-tertiary" 
															       id="MSSV_InforSinhVien" placeholder="MSSV" 
															       value="@maSo" readonly>
															<label for="MSSV_InforSinhVien">MSSV</label>
														</div>
													</div>

													<!-- ⭐ THAY ĐỊA CHỈ BẰNG TÊN KHOA (READONLY) ⭐ -->
													<div class="col-md-12">
														<div class="form-floating">
															<input type="text" class="form-control bg-body-tertiary" 
															       id="khoaName_InforSinhVien" placeholder="Khoa" 
															       value="@tenKhoa" readonly>
															<label for="khoaName_InforSinhVien">Khoa</label>
														</div>
													</div>
												</div>
											</div>
										</div>
									</form>
								</div>

								<div class="modal-footer">
									<div class="me-auto text-muted small" id="saveStatus" style="display:none;"></div>
									<button type="button" class="btn btn-secondary text-light" data-bs-dismiss="modal">Đóng</button>
									<button type="button" class="btn btn-primary text-light" id="saveBtn">Cập nhật</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</nav>
	</header>


	<!-- Main content -->
	<main class="d-flex flex-grow-1" style="margin-top:70px;">
		<!-- Nav dọc bên trái màn hình hớn-->
		<aside class="bg-body-tertiary p-3 pt-4 d-flex flex-column d-none d-md-flex position-fixed top-0 start-0 h-100" style="width: 180px; margin-top: 25px;">
			<ul class="nav flex-column gap-2 flex-grow-1 mt-5">
				<li class="nav-item">
					<a class="nav-link fw-semibold d-flex align-items-center gap-2  rounded-3 @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" ? "active bg-primary text-light" : "text-body-emphasis")"
					   asp-controller="Home" asp-action="Index" >
						<i class="bi bi-house-door"></i> Trang chủ
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link fw-semibold d-flex align-items-center gap-2  rounded-3  @(ViewContext.RouteData.Values["controller"]?.ToString() != "Home" ? "active bg-primary text-light" : "text-body-emphasis")"
					   asp-area="Student" asp-controller="KhoaHoc" asp-action="Index">
						<i class="bi bi-journal-bookmark"></i> Khóa học
					</a>
				</li>
			</ul>
		</aside>

		<!-- Sidebar responsive: offcanvas trên <md; static từ md trở lên -->
		<aside id="sidebarMenu"
			   class="offcanvas offcanvas-start offcanvas-md bg-body-tertiary p-3 pt-3 d-flex flex-column"
			   tabindex="-1" aria-labelledby="sidebarMenuLabel">
			<!-- Offcanvas header (chỉ hiển thị khi offcanvas, tức < md) -->
			<div class="offcanvas-header d-md-none align-items-center justify-content-between">
				<!-- logo trong offcanvas (mobile) -->
				<a href="/" class="navbar-brand d-flex align-items-center">
					<img src="~/assets/image/logo.png" height="36" alt="logo">
				</a>

				<button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Đóng"></button>
			</div>

			<div class="offcanvas-body p-0 d-flex flex-column pt-3">
				<ul class="nav flex-column gap-2 flex-grow-1">
					<li class="nav-item">
						<a class="nav-link fw-semibold d-flex align-items-center gap-2 rounded-3 @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" ? "active bg-primary text-light" : "text-body-emphasis")" asp-controller="Home" asp-action="Index">
							<i class="bi bi-house-door"></i> Trang chủ
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link fw-semibold d-flex align-items-center gap-2 rounded-3 @(ViewContext.RouteData.Values["controller"]?.ToString() != "Home" ? "active bg-primary text-light" : "text-body-emphasis")" asp-area="Student" asp-controller="KhoaHoc" asp-action="Index">
							<i class="bi bi-journal-bookmark"></i> Khóa học
						</a>
					</li>					
				</ul>
			</div>
		</aside>


		<!-- Nội dung chính -->
		<section class="flex-grow-1 p-4" id="bodyMainContent">
			@RenderBody()
		</section>
	</main>




	<!-- JS -->
	<script src="~/assets/js/student/Js_LamTracNghiem.js"></script>
	<script src="~/assets/js/student/js_layout.js"></script>
	<script src="~/assets/js/student/KhoaHoc.js"></script>
	
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<!-- Bootstrap JS (bundle kèm Popper.js) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	
	<!-- ⭐ THÊM SWEETALERT2 ⭐ -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	
	<!--Flatpickl Bootstraps-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.vi.min.js"></script>
	
	<script>
		$('#dob').datepicker({
		  format: "dd/mm/yyyy",
		  endDate: "0d",
		  autoclose: true,
		  todayHighlight: true,
		  language: "vi"
		});
	</script>

	<!-- ⭐ THÊM DÒNG NÀY ĐỂ RENDER SCRIPTS TỪ VIEW ⭐ -->
	@RenderSection("Scripts", required: false)
</body>
</html>
